-- search recipie by name
SELECT iname AS results
FROM ingredients 
WHERE iname LIKE '_iquery%'

-- search recipie by name only
SELECT rname AS results
FROM recipies
WHERE name LIKE '_rquery%'

-- search recipie by type and name (recipietypequery as set of all types default, rquery as empty string as default)
select rname AS results
FROM recipies 
WHERE (recipietype IN recipietypequery) AND name LIKE '_rquery%'

-- gives sum of search result
SELECT SUM(results)
FROM NESTEDQUERY

-- sort recipies by number of ingredients we have
WITH available_ingredients AS (
    SELECT fridgeingredients. ingredient
    FROM fridgeingredients
    INNER JOIN fridges ON fridges.id = fridgeingredients.fridge
    WHERE fridges.id = 0
)
SELECT recipes.name, COUNT(available_ingredients.ingredient) AS num_available
FROM recipes
INNER JOIN recipeingredients ON recipes.name = recipeingredients.recipe
INNER JOIN available_ingredients ON available_ingredients.ingredient = recipeingredients.ingredient
GROUP BY recipes.name
ORDER BY num_available DESC;